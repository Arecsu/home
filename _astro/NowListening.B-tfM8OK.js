import{f as O,h as b,d as F,H as M,r as j,s as z,i as P,j as k,k as x,p as L,b as Q,E as B,l as H,n as v,o as p,q as _,v as C,w as N,x as G,y as J,z as K,A as y,t as V,B as Y,C as W,D as X,F as Z,G as ee,I as S,J as te,K as T,L as I,M as D,N as ne,O as se,P as re}from"./render.yqEuM4O4.js";const ae="5";typeof window<"u"&&(window.__svelte||={v:new Set}).v.add(ae);function U(e){throw new Error("lifecycle_outside_component")}function ie(e,s,t,n=null,a=!1){b&&F();var r=e,i=null,o=null,l=null,f=a?B:0;O(()=>{if(l===(l=!!s()))return;let d=!1;if(b){const g=r.data===M;l===g&&(r=j(),z(r),P(!1),d=!0)}l?(i?k(i):i=x(()=>t(r)),o&&L(o,()=>{o=null})):(o?k(o):n&&(o=x(()=>n(r))),i&&L(i,()=>{i=null})),d&&P(!0)},f),b&&(r=Q)}function le(e,s,t,n,a){b&&F();var r=s.$$slots?.[t],i=!1;r===!0&&(r=s[t],i=!0),r===void 0||r(e,i?()=>n:n)}function oe(e,s,t){if(t){if(e.classList.contains(s))return;e.classList.add(s)}else{if(!e.classList.contains(s))return;e.classList.remove(s)}}function ce(e=!1){const s=p,t=s.l.u;if(!t)return;let n=()=>J(s.s);if(e){let a=0,r={};const i=K(()=>{let o=!1;const l=s.s;for(const f in l)l[f]!==r[f]&&(r[f]=l[f],o=!0);return o&&a++,a});n=()=>N(i)}t.b.length&&H(()=>{R(s,n),C(t.b)}),v(()=>{const a=_(()=>t.m.map(G));return()=>{for(const r of a)typeof r=="function"&&r()}}),t.a.length&&v(()=>{R(s,n),C(t.a)})}function R(e,s){if(e.l.s)for(const t of e.l.s)N(t);s()}function fe(e){p===null&&U(),p.l!==null?de(p).m.push(e):v(()=>{const s=_(e);if(typeof s=="function")return s})}function ue(e){p===null&&U(),fe(()=>()=>_(e))}function de(e){var s=e.l;return s.u??={a:[],b:[],m:[]}}function pe(e,s,t){if(e==null)return s(void 0),y;const n=_(()=>e.subscribe(s,t));return n.unsubscribe?()=>n.unsubscribe():n}function $(e,s,t){const n=t[s]??={store:null,source:Y(void 0),unsubscribe:y};if(n.store!==e)if(n.unsubscribe(),n.store=e??null,e==null)n.source.v=void 0,n.unsubscribe=y;else{var a=!0;n.unsubscribe=pe(e,r=>{a?n.source.v=r:W(n.source,r)}),a=!1}return N(n.source)}function he(){const e={};return V(()=>{for(var s in e)e[s].unsubscribe()}),e}let c=[],u=0;const h=4;let q=e=>{let s=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(n){return t.lc=s.push(n),()=>{for(let r=u+h;r<c.length;)c[r]===n?c.splice(r,h):r+=h;let a=s.indexOf(n);~a&&(s.splice(a,1),--t.lc||t.off())}},notify(n,a){let r=!c.length;for(let i of s)c.push(i,t.value,n,a);if(r){for(u=0;u<c.length;u+=h)c[u](c[u+1],c[u+2],c[u+3]);c.length=0}},off(){},set(n){let a=t.value;a!==n&&(t.value=n,t.notify(a))},subscribe(n){let a=t.listen(n);return n(t.value),a},value:e};return t};const m=q(null),w=q(!1),be=e=>{if(e.includes("-")){const s=["remaster","remastered"],t=e.split("-").map(a=>a.trim());return s.some(a=>t[t.length-1].toLowerCase().includes(a))&&t.pop(),t.join(" - ")}else return e};async function _e(){let e;try{e=await(await fetch("https://lastfm-a9r.martyr.workers.dev/")).text()}catch{throw console.error("Error fetching Now Listening data!"),Error("Error fetching Now Listening data!")}const t=new DOMParser().parseFromString(e,"text/html"),n=t.querySelector("tbody tr:first-child:has(.chartlist-now-scrobbling) .chartlist-name a")?.textContent,a=t.querySelector("tbody tr:first-child:has(.chartlist-now-scrobbling) .chartlist-artist a")?.textContent;return!n||!a?null:{track:be(n),artist:a}}async function A(){try{const e=await _e();e&&e!==m.get()&&m.set(e),w.set(!!e)}catch(e){console.error(e)}}let E;function ge(){A(),E=setInterval(A,10*1e3)}function ve(){E&&clearInterval(E)}var ye=se('<div class="now-listening svelte-13br9z"><span class="listening-to">in my ears now â†™</span> <a class="no-underline disable-link-arrow svelte-13br9z" href="https://www.last.fm/user/Alejandro9R/" target="_blank"><!> </a></div>');function we(e,s){X(s,!1);const t=he(),n=()=>$(m,"$musicData",t),a=()=>$(w,"$isCurrentlyPlaying",t);ge(),ue(()=>{ve(),w.set(!1)}),ce();var r=Z(),i=ee(r);ie(i,n,o=>{var l=ye(),f=T(I(l),2),d=I(f);le(d,s,"icon",{});var g=T(d);D(f),D(l),ne(()=>{oe(l,"is-playing",a()),re(g,` ${n()?.artist??""} - ${n()?.track??""}`)}),S(o,l)}),S(e,r),te()}export{we as default};
