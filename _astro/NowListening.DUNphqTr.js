import{v as j,w as B,m as b,p as O,E as H,H as Y,x as Z,y as z,z as x,A as k,B as C,C as T,n as G,U as J,D as K,F as w,G as p,I as y,J as S,d as I,K as W,L as X,M as ee,N as te,O as E,t as ne,P as se,c as re,Q as ae,R as ie,T as le,V as D,W as oe,X as R,Y as U,Z as $,_ as ce,$ as ue,a0 as fe}from"./render.CQdo2hdn.js";const de="5";typeof window<"u"&&(window.__svelte||={v:new Set}).v.add(de);j();function q(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function he(e,s,n=!1){b&&O();var t=e,r=null,a=null,i=J,h=n?H:0,l=!1;const o=(v,u=!0)=>{l=!0,_(u,v)},_=(v,u)=>{if(i===(i=v))return;let P=!1;if(b){const V=t.data===Y;!!i===V&&(t=Z(),z(t),x(!1),P=!0)}i?(r?k(r):u&&(r=C(()=>u(t))),a&&T(a,()=>{a=null})):(a?k(a):u&&(a=C(()=>u(t))),r&&T(r,()=>{r=null})),P&&x(!0)};B(()=>{l=!1,s(o),l||_(null,null)},h),b&&(t=G)}function ve(e,s,n,t,r){b&&O();var a=s.$$slots?.[n],i=!1;a===!0&&(a=s[n],i=!0),a===void 0||a(e,i?()=>t:t)}function _e(e,s,n){if(n){if(e.classList.contains(s))return;e.classList.add(s)}else{if(!e.classList.contains(s))return;e.classList.remove(s)}}function pe(e=!1){const s=p,n=s.l.u;if(!n)return;let t=()=>X(s.s);if(e){let r=0,a={};const i=ee(()=>{let h=!1;const l=s.s;for(const o in l)l[o]!==a[o]&&(a[o]=l[o],h=!0);return h&&r++,r});t=()=>I(i)}n.b.length&&K(()=>{A(s,t),S(n.b)}),w(()=>{const r=y(()=>n.m.map(W));return()=>{for(const a of r)typeof a=="function"&&a()}}),n.a.length&&w(()=>{A(s,t),S(n.a)})}function A(e,s){if(e.l.s)for(const n of e.l.s)I(n);s()}function ge(e){p===null&&q(),te&&p.l!==null?me(p).m.push(e):w(()=>{const s=y(e);if(typeof s=="function")return s})}function be(e){p===null&&q(),ge(()=>()=>y(e))}function me(e){var s=e.l;return s.u??={a:[],b:[],m:[]}}function ye(e,s,n){if(e==null)return s(void 0),E;const t=y(()=>e.subscribe(s,n));return t.unsubscribe?()=>t.unsubscribe():t}function F(e,s,n){const t=n[s]??={store:null,source:se(void 0),unsubscribe:E};if(t.store!==e)if(t.unsubscribe(),t.store=e??null,e==null)t.source.v=void 0,t.unsubscribe=E;else{var r=!0;t.unsubscribe=ye(e,a=>{r?t.source.v=a:re(t.source,a)}),r=!1}return I(t.source)}function we(){const e={};return ne(()=>{for(var s in e)e[s].unsubscribe()}),e}let c=[],f=0;const g=4;let M=e=>{let s=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(t){return n.lc=s.push(t),()=>{for(let a=f+g;a<c.length;)c[a]===t?c.splice(a,g):a+=g;let r=s.indexOf(t);~r&&(s.splice(r,1),--n.lc||n.off())}},notify(t,r){let a=!c.length;for(let i of s)c.push(i,n.value,t,r);if(a){for(f=0;f<c.length;f+=g)c[f](c[f+1],c[f+2],c[f+3]);c.length=0}},off(){},set(t){let r=n.value;r!==t&&(n.value=t,n.notify(r))},subscribe(t){let r=n.listen(t);return t(n.value),r},value:e};return n};const N=M(null),L=M(!1);let d;const Ee=e=>{if(e.includes("-")){const s=["remaster","remastered"],n=e.split("-").map(r=>r.trim());return s.some(r=>n[n.length-1].toLowerCase().includes(r))&&n.pop(),n.join(" - ")}else return e};async function Ne(){let e;try{e=await(await fetch("https://lastfm-a9r.martyr.workers.dev/")).text()}catch{throw console.error("Error fetching Now Listening data!"),Error("Error fetching Now Listening data!")}const n=new DOMParser().parseFromString(e,"text/html"),t=n.querySelector("tbody tr:first-child:has(.chartlist-now-scrobbling) .chartlist-name a")?.textContent,r=n.querySelector("tbody tr:first-child:has(.chartlist-now-scrobbling) .chartlist-artist a")?.textContent;return!t||!r?null:{track:Ee(t),artist:r}}async function m(){if(document.hidden){clearInterval(d),d=null;return}try{const e=await Ne();e&&e!==N.get()&&N.set(e),L.set(!!e)}catch(e){console.error(e)}}function Le(){m(),d=setInterval(m,10*1e3),document.addEventListener("visibilitychange",Q)}function Ie(){d&&(clearInterval(d),d=null,document.removeEventListener("visibilitychange",Q))}function Q(){!document.hidden&&!d&&(m(),d=setInterval(m,10*1e3))}var Pe=ue('<div class="now-listening svelte-rdewev"><span class="listening-to">in my ears now â†™</span> <a class="no-underline disable-link-arrow svelte-rdewev" href="https://www.last.fm/user/Alejandro9R/" target="_blank"><!> </a></div>');function ke(e,s){ae(s,!1);const n=we(),t=()=>F(N,"$musicData",n),r=()=>F(L,"$isCurrentlyPlaying",n);Le(),be(()=>{Ie(),L.set(!1)}),pe();var a=ie(),i=le(a);{var h=l=>{var o=Pe(),_=R(U(o),2),v=U(_);ve(v,s,"icon",{});var u=R(v);$(_),$(o),ce(()=>{_e(o,"is-playing",r()),fe(u,` ${t()?.artist??""} - ${t()?.track??""}`)}),D(l,o)};he(i,l=>{t()&&l(h)})}D(e,a),oe()}export{ke as default};
